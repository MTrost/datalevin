#!/bin/bash

# Binaries and data dirs
QUERY_DIR=./queries

echo "The Join Order Benchmark 1Pass test ..."
echo -e "Query Name,Execution Time (ms)" > job_onepass_time.csv

for file in $QUERY_DIR/*.sql
do
  # Get filename
  short_file=$(basename "$file")
  query_name="${short_file%.*}"
  echo -n "EXPLAIN (ANALYZE, FORMAT JSON) " > test.sql
  cat $file >> test.sql
  result=$(psql -U postgres -p 5434 -f test.sql)
  echo $result > $short_file".json"
  exec_time=$(echo $result | sed -n 's/.*"Execution Time": \([0-9]*\.[0-9]*\).*/\1/p')
  echo -e "$query_name,$exec_time" >> job_onepass_time.csv
done
